test: Exact Phrase Matching

setup:
  - ref: ../base-vars.humane.yml
  - I have a "public/index.html" file with the content "<p>Hello World</p>"

steps:
  - I have a "public/cat/index.html" file with the content "<html lang='en'><body><h1>Happy post about cats</h1></body></html>"
  - step: I have a "public/dog/index.html" file with the content {html}
    html: |-
      <html lang="en">
        <body>
          <h1>A post about how cats do not like dogs</h1>
          <p>More content</p>
        </body>
      </html>

  - I have the environment variable "A" set to "my variable a"
  - I run "echo $A"
  - stdout should contain "variable"
  - stdout should not contain "constant"
  # --snip--
  - stdout should not be empty
  - stdout should be exactly {content}

  - step: The file "rosey/base.json" should contain the values {values}
    values:
      version: 2
      keys:
        seal:
          original: ðŸ¦­
        e:
          original: xx
  - step: The file "rosey/base.json" should be exactly the data {values}
    values:
      version: 2
      keys:
        seal:
          original: ðŸ¦­
        e:
          original: xx

  - step: The file "en/index.html" should contain an html node matching {node}
    node: "<a href='/en/>Click here if you are not redirected</a>"

  - step: The file "en/index.html" should contain an html node matching {node}
    node:
      tag: a
      innerText: Hello World
      attributes:
        href: "/en/"

  # - snapshot: The directory "public"
  - I serve the directory "public"
  - In my browser, I load "/"
  - step: In my browser, I evaluate {js}
    js: |-
      let p = document.querySelector("p");
      humane.assert_eq(p.innerText, "Hello World");

  # - step: In my browser, I evaluate {js}
  #   js: |-
  #     let pagefind = await import("/pagefind/pagefind.js");
  #     let search = await pagefind.search(`"about cats"`);

  #     humane.assert_eq(search.results.length, 1);
  #     humane.assert_eq(data?.url, "/cat/");

  # - In my browser, there should be no logs
  # - snapshot: In my browser, the element "input.pagefind"
